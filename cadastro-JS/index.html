<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon"
        href="data:image/png;base64,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"
        type="image/x-icon">
    <title>Cadastro de Tarefas</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container-body">
        <h1>Cadastro de Tarefas</h1>
        <button class="btn-deslogar" onclick="deslogar()">Deslogar</button>

        <form id="form">
            <label for="">Nome da tarefa:</label><br>
            <input type="text" placeholder="Nome da tarefa" name="inp_nome" id="inp_nome"><br>
            <label for="">Descrição da tarefa:</label><br>
            <textarea type="number" placeholder="Descrição do Produto" name="inp_descricao"
                id="inp_descricao"></textarea><br>
            <label for="inp_data_vencimento">Data de Vencimento:</label><br>
            <input type="date" name="inp_data_vencimento" id="inp_data_vencimento"><br>
            <label for="inp_prioridade">Prioridade:</label><br>
            <select name="inp_prioridade" id="inp_prioridade">
                <option value="alta">Alta</option>
                <option value="media">Média</option>
                <option value="baixa">Baixa</option>
            </select><br>
            <label for="inp_status">Status:</label><br>
            <select name="inp_status" id="inp_status">
                <option value="pendente">Pendente</option>
                <option value="em_andamento">Em Andamento</option>
                <option value="concluida">Concluída</option>
            </select><br>
            <button type="submit">Cadastrar</button>
        </form>

        <table id="table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Nome da Tarefa</th>
                    <th>Descrição</th>
                    <th>Data de Vencimento</th>
                    <th>Prazo</th>
                    <th>Prioridade</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
                <tr>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Editar tarefa</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formularioModal">
                        <div class="mb-3">
                            <label for="modal_nome_tarefa" class="form-label">Nome da Tarefa:</label>
                            <input type="text" class="form-control" id="modal_nome_tarefa" name="modal_nome_tarefa"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="modal_descricao" class="form-label">Descrição da Tarefa:</label>
                            <textarea class="form-control" id="modal_descricao" name="modal_descricao"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="modal_data_vencimento" class="form-label">Data de Vencimento:</label>
                            <input type="date" class="form-control" id="modal_data_vencimento"
                                name="modal_data_vencimento">
                        </div>

                        <div class="mb-3">
                            <label for="modal_prioridade" class="form-label">Prioridade:</label>
                            <select class="form-select" id="modal_prioridade" name="modal_prioridade">
                                <option value="alta">Alta</option>
                                <option value="media">Média</option>
                                <option value="baixa">Baixa</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="modal_status" class="form-label">Status:</label>
                            <select class="form-select" id="modal_status" name="modal_status">
                                <option value="pendente">Pendente</option>
                                <option value="em_andamento">Em Andamento</option>
                                <option value="concluida">Concluída</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Salvar Mudanças</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        if (!window.localStorage.getItem("login")) {
            window.location.href = "./login.html"
        }
        var form = document.querySelector("#form");
        var table = document.querySelector("#table");
        var linhaEditada = '';

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            const nome = window.localStorage.getItem("login");
            const nomeTarefa = document.querySelector("#inp_nome").value;
            const descricaoTarefa = document.querySelector("#inp_descricao").value;
            const dataVencimento = document.querySelector("#inp_data_vencimento").value;
            const prioridade = document.querySelector("#inp_prioridade").value;
            const status = document.querySelector("#inp_status").value;

            if (nomeTarefa == '') {
                alert("Preencha o nome da tarefa, por favor")
                return;
            }
            if (descricaoTarefa == '') {
                alert("Preencha a descrição da tarefa, por favor")
                return;
            }
            if (dataVencimento == '') {
                alert("Preencha a data de vencimento da tarefa, por favor")
                return;
            }


            const newRow = table.insertRow(1);
            const newCell0 = newRow.insertCell(0);
            const newCell1 = newRow.insertCell(1);
            const newCell2 = newRow.insertCell(2);
            const newCell3 = newRow.insertCell(3);
            const newCell4 = newRow.insertCell(4);
            const newCell5 = newRow.insertCell(5);
            const newCell6 = newRow.insertCell(6);
            const newCell7 = newRow.insertCell(7);

            let nomeText = document.createTextNode(nome);
            let nomeTarefaText = document.createTextNode(nomeTarefa);
            let descricaoText = document.createTextNode(descricaoTarefa);
            let dataVencimentoText = document.createTextNode(formatarData(dataVencimento));
            let prazoText = document.createTextNode(calcularPrazo(dataVencimento));
            let prioridadeText = document.createTextNode(formatarDescricaoPrioridade(prioridade));
            let statusText = document.createTextNode(formatarDescricaoStatus(status));

            let action = document.createElement("button");
            action.classList.add("btn-remover");
            action.innerText = "Remover";
            action.setAttribute("onclick", "remover(this.parentNode.parentNode)");

            let action2 = document.createElement("button");
            action2.classList.add("btn-editar");
            action2.setAttribute("data-bs-toggle", "modal");
            action2.setAttribute("data-bs-target", "#exampleModal");
            action2.innerText = "Editar";
            action2.addEventListener("click", function () {
                linhaEditada = this.parentNode.parentNode;
                preencherFormularioModal();
            });

            newCell0.appendChild(nomeText);
            newCell1.appendChild(nomeTarefaText);
            newCell2.appendChild(descricaoText);
            newCell3.appendChild(dataVencimentoText);
            newCell4.appendChild(prazoText);
            newCell5.appendChild(prioridadeText);
            newCell6.appendChild(statusText);
            newCell7.appendChild(action);
            newCell7.appendChild(action2);
        });
        function formatarData(data) {
            const date = new Date(data);
            return `${date.getDate() + 1}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`
        }
        function calcularPrazo(dataVencimento) {
            const dataVencimentoObj = new Date(dataVencimento);

            const dataAtual = new Date();

            const diferencaEmMilissegundos = dataVencimentoObj - dataAtual;

            //Math.ceil arrendonda para cima
            const diferencaEmDias = Math.ceil(diferencaEmMilissegundos / (1000 * 60 * 60 * 24));

            return diferencaEmDias > 0 ? `${diferencaEmDias} dias restantes` : "Tarefa vencida";
        }
        function formatarDescricaoPrioridade(valor) {
            switch (valor) {
                case "alta":
                    return "Alta";
                case "media":
                    return "Média";
                case "baixa":
                    return "Baixa";
            }
        }

        function formatarDescricaoStatus(valor) {
            switch (valor) {
                case "pendente":
                    return "Pendente";
                case "em_andamento":
                    return "Em Andamento";
                case "concluida":
                    return "Concluída";
            }
        }
        function remover(linha) {
            linha.parentNode.removeChild(linha)
        }
        function preencherFormularioModal() {

            let nomeTarefaAtual = linhaEditada.cells[1].innerText;
            let descricaoAtual = linhaEditada.cells[2].innerText;
            let dataVencimentoAtual = linhaEditada.cells[3].innerText;
            let prioridadeAtual = linhaEditada.cells[5].innerText;
            let statusAtual = linhaEditada.cells[6].innerText;

            document.getElementById("modal_nome_tarefa").value = nomeTarefaAtual;
            document.getElementById("modal_descricao").value = descricaoAtual;
            document.getElementById("modal_data_vencimento").value = desformatarData(dataVencimentoAtual);
            document.getElementById("modal_prioridade").value = desformatarPrioridade(prioridadeAtual);
            document.getElementById("modal_status").value = desformatarStatus(statusAtual);
        }
        function desformatarData(dataFormatada) {
            const partesData = dataFormatada.split('/');
            return `${partesData[2]}-${partesData[1]}-${partesData[0]}`;
        }

        function desformatarPrioridade(prioridadeFormatada) {
            switch (prioridadeFormatada) {
                case "Alta":
                    return "alta";
                case "Média":
                    return "media";
                case "Baixa":
                    return "baixa";
            }
        }
        function desformatarStatus(statusFormatado) {
            switch (statusFormatado) {
                case "Pendente":
                    return "pendente";
                case "Em Andamento":
                    return "em_andamento";
                case "Concluída":
                    return "concluida";
            }
        }
        document.getElementById("formularioModal").addEventListener("submit", function (e) {
            e.preventDefault();
            editarLinha();
        })
        function editarLinha() {
            linhaEditada.cells[1].innerText = document.getElementById("modal_nome_tarefa").value;
            linhaEditada.cells[2].innerText = document.getElementById("modal_descricao").value;
            linhaEditada.cells[3].innerText = formatarData(document.getElementById("modal_data_vencimento").value);
            linhaEditada.cells[4].innerText = calcularPrazo(document.getElementById("modal_data_vencimento").value);
            linhaEditada.cells[5].innerText = formatarDescricaoPrioridade(document.getElementById("modal_prioridade").value);
            linhaEditada.cells[6].innerText = formatarDescricaoStatus(document.getElementById("modal_status").value);
        }
        function deslogar() {
            window.localStorage.removeItem("login");
            window.location.href = "./login.html"
        }
    </script>
</body>

</html>